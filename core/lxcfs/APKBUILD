pkgname=lxcfs
pkgver=4.0.1
pkgrel=0
pkgdesc="FUSE filesystem for LXC"
url="https://linuxcontainers.org/lxcfs"
arch="all"
license="Apache-2.0"
depends="cgmanager shadow uidmapshift"
makedepends="fuse-dev linux-dev help2man"
subpackages="$pkgname-doc $pkgname-openrc"
source="${pkgname}-${pkgver}.tar.gz::https://github.com/lxc/lxcfs/archive/${pkgname}-${pkgver}.tar.gz
	lxcfs.confd
	lxcfs.initd
	"
builddir="$srcdir/lxcfs-lxcfs-$pkgver"

prepare() {
	default_prepare
	autoreconf -ifv
}

build() {
	./configure --prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--mandir=/usr/share/man \
		--infodir=/usr/share/info \
		--with-init-script=openrc
	make
}

check() {
	make check
}


package() {
	make DESTDIR="$pkgdir" install
	install -m755 -D "$srcdir"/$pkgname.initd \
		"$pkgdir"/etc/init.d/$pkgname
	install -m644 -D "$srcdir"/$pkgname.confd \
		"$pkgdir"/etc/conf.d/$pkgname
}

b2sums="32c1e89b4f05717341fa73a47d60ae858cebe18c47caa905e83e28263958f31d4ca7ae2cc2f3d4457b173201681a4a0f54f75b92bba05e3ff1ade8295dda6844  lxcfs-4.0.1.tar.gz
0664072178302f7b9becc80ee30f47187188d4343fb9e47dbf862dc03157f69899e8866b2e45fd7b9fa69a1b121c4fc7ee1a76adb7943842c20c1752f55f2495  lxcfs.confd
09be32853f8620403c8d7cb67a090836667849245836a492169e70c3589f460945a8a52a09f6a267aa4eddd1ce3b74748706ff6d7be7fcb6846a00e024868ba3  lxcfs.initd"
