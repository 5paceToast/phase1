#bump:1
pkgname=compiler-rt

. ../../devel/llvm/common.inc

source="https://github.com/llvm/llvm-project/releases/download/llvmorg-$pkgver/$pkgname-$pkgver.src.tar.xz
	mips64_crt.patch"

builddir="$srcdir/$pkgname-$pkgver.src"
_builddir="$srcdir/build"

makedepends="cmake clang lld ninja llvm-dev clang-dev python3"

prepare() {
	default_prepare

	mkdir -p $_builddir && cd $_builddir

	cmake -G Ninja -Wno-dev \
			-DCMAKE_C_COMPILER=$CC \
			-DCMAKE_CXX_COMPILER=$CXX \
			-DCMAKE_C_COMPILER_TARGET=$CTARGET \
			-DCMAKE_CXX_COMPILER_TARGET=$CTARGET \
			-DCMAKE_C_FLAGS="$CFLAGS" \
			-DCMAKE_CXX_FLAGS="$CXXFLAGS" \
			-DCMAKE_INSTALL_PREFIX=/usr/lib/clang/${pkgver} \
			-DCMAKE_BUILD_TYPE=Release \
			-DCOMPILER_RT_USE_BUILTINS_LIBRARY=ON \
			-DCOMPILER_RT_DEFAULT_TARGET_ONLY=OFF \
			-DCOMPILER_RT_INCLUDE_TESTS=OFF \
			-DCOMPILER_RT_BUILD_SANITIZERS=OFF \
			-DCOMPILER_RT_BUILD_XRAY=OFF \
			-DCOMPILER_RT_INCLUDE_TESTS=OFF \
			$builddir

}

build() {
	cd $_builddir
	ninja -j${JOBS}
}

package() {
	cd $_builddir
	DESTDIR="$pkgdir" ninja install
}
b2sums="53a727b528baa99de0c09aaefaabe9a1eee134e2bd744fdc44aadf9bc2823d036c88a7a02d7e7853f7d2214736dbaf66d40aeb5d07fee25d8f99413734519f70  compiler-rt-9.0.1.src.tar.xz
6cbae4577fb643672a2e46cd7bfd49e65368b106ac287d69b26c3daca042022fa35ff4c555a2c6eab6581ae6c27cd5700167670031b7787693dabbaca0dd942b  mips64_crt.patch"
