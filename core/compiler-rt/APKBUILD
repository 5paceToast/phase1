pkgname=compiler-rt
pkgver=9.0.0
pkgrel=0
pkgdesc="$pkgname"
source="http://releases.llvm.org/$pkgver/$pkgname-$pkgver.src.tar.xz"
arch="all"
url=.
license=.
subpackages="$pkgname-dev"

builddir="$srcdir/llvm-project-llvmorg-$pkgver"
_builddir="$srcdir/build"

makedepends="cmake clang lld ninja llvm-dev clang-dev"

prepare() {
	default_prepare

	mkdir -p $_builddir && cd $_builddir

	cmake -G Ninja -Wno-dev \
			-DCMAKE_C_COMPILER=$CC \
			-DCMAKE_CXX_COMPILER=$CXX \
			-DCMAKE_C_COMPILER_TARGET=$CTARGET \
			-DCMAKE_CXX_COMPILER_TARGET=$CTARGET \
			-DCMAKE_C_FLAGS="$CFLAGS" \
			-DCMAKE_CXX_FLAGS="$CXXFLAGS" \
			-DCMAKE_INSTALL_PREFIX=/usr \
			-DCMAKE_BUILD_TYPE=Release \
			-DLLVM_ENABLE_PROJECTS="compiler-rt" \
			-DCOMPILER_RT_USE_BUILTINS_LIBRARY=ON \
			-DCOMPILER_RT_DEFAULT_TARGET_ONLY=OFF \
			-DCOMPILER_RT_INCLUDE_TESTS=OFF \
			-DCOMPILER_RT_BUILD_SANITIZERS=OFF \
			-DCOMPILER_RT_BUILD_XRAY=OFF \
			-DCOMPILER_RT_INCLUDE_TESTS=OFF \
			$builddir/$pkgname-$pkgver.src

}

build() {
	cd $_builddir
	ninja -j${JOBS} crt compiler-rt
}

package() {
	cd $_builddir
	DESTDIR="$pkgdir" ninja install-crt install-compiler-rt
}
b2sums="4aece9570df4cc38aaa58a3740aa0e1b5cbfe0bfc2d1a590e9e95871fda6ba4dcdeab6125d243c31ce5130386235475339f13da9f900b505eb2fec850a711646  compiler-rt-9.0.0.src.tar.xz"
